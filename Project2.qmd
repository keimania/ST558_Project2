---
title: "Project 2: Seoul Bike Sharing Data Exploration"
author: "Jamin Goo"
format: 
  html:
    self-contained: true
editor: visual
---

## 1. Data Loading and Preparation

First, we load the necessary libraries and the dataset. The dataset is 'Seoul Bike Sharing Data'.

We'll also clean up the column names for easier use and convert categorical variables into factors with more descriptive labels.

```{r}

# Load libraries
library(tidyverse)
library(lubridate)
library(knitr)

# Load data
bike_data_raw <- read_csv("./data/SeoulBikeData.csv", locale = locale(encoding = "latin1"))

bike_data_raw

# Clean and prepare data
bike_data <- bike_data_raw |>
  janitor::clean_names() |>
  mutate(
    date = dmy(date),
    seasons = factor(seasons, levels = c("Spring", "Summer", "Autumn", "Winter")),
    holiday = factor(holiday, levels = c("No Holiday", "Holiday")),
    functioning_day = factor(functioning_day, levels = c("Yes", "No")),
    hour = factor(hour)
  )

head(bike_data)
```

## 2. Numerical Summaries

Here we explore the data using numerical tables to understand distributions and relationships.

### One-Way Contingency Tables

```{r}
# Frequency of observations by Season
bike_data |>
  group_by(seasons) |>
  summarize(count = n())
```

### Two-Way Contingency Tables

```{r}
# Season and Holiday
bike_data |>
  group_by(seasons, holiday) |>
  summarize(count = n())
```

### Summaries of Quantitative Variables

Here, we calculate summary statistics (mean, median, standard deviation) for quantitative variables, grouped by the seasons and holiday variable.

```{r}
bike_data |>
  group_by(seasons, holiday) |>
  summarize(
    across(
      where(is.numeric),
      list(
        mean = ~ mean(.x, na.rm = TRUE),
        median = ~ median(.x, na.rm = TRUE),
        sd = ~ sd(.x, na.rm = TRUE)
      ),
      .names = "{.col}_{.fn}"
    )
  )
```

## 3. Graphical Summaries

We create six plots.

### Plot 1: Average Bike Rentals per Hour by Season

```{r}
bike_data |>
  group_by(seasons, hour) |>
  summarize(avg_rentals = mean(rented_bike_count), .groups = 'drop') |>
  ggplot(aes(x = hour, y = avg_rentals, color = seasons, group = seasons)) +
  geom_line(linewidth = 1) +
  labs(
    title = "Average Bike Rentals Throughout the Day by Season",
    x = "Hour of Day",
    y = "Average Number of Rented Bikes",
    color = "Season"
  )
```

### Plot 2: Bike Rentals vs. Temperature with Faceting

```{r}
ggplot(bike_data, aes(x = temperature_c, y = rented_bike_count, color = seasons)) +
  geom_point(alpha = 0.3) +
  facet_wrap(~seasons) +
  labs(
    title = "Bike Rentals vs Temperature by Season",
    x = "Temperature (Â°C)",
    y = "Rented Bike Count"
  )
```

### Plot 3: Distribution of Bike Rentals on Holidays vs. Non-Holidays

```{r}
ggplot(bike_data, aes(x = hour, y = rented_bike_count, fill = holiday)) +
  geom_boxplot() +
  labs(
    title = "Bike Rental Distribution by Hour: Holiday vs Non-Holiday",
    x = "Hour of Day",
    y = "Rented Bike Count"
  )
```

### Plot 4: Rentals vs. Wind Speed by Holiday Status

```{r}
ggplot(bike_data, aes(x = wind_speed_m_s, y = rented_bike_count, color = holiday)) +
  geom_jitter(width = 0.2, alpha = 0.3) +
  labs(
    title = "Bike Rentals vs Wind Speed",
    x = "Wind Speed (m/s)",
    y = "Rented Bike Count"
  )
```

### Plot 5: Density of Humidity by Functioning Day

```{r}
ggplot(bike_data, aes(x = humidity_percent, fill = functioning_day)) +
  geom_density(alpha = 0.5) +
  labs(
    title = "Distribution of Humidity by Functioning Day Status",
    x = "Humidity (%)",
    y = "Density"
  )
```

### Plot 6: Correlation Heatmap

```{r}
# Select only numeric variables for correlation matrix
numeric_vars <- bike_data |>
  select(where(is.numeric))

# Calculate correlation
cor_matrix <- cor(numeric_vars)

# Convert to long format for ggplot
cor_data <- as.data.frame(cor_matrix) |>
  rownames_to_column("var1") |>
  pivot_longer(-var1, names_to = "var2", values_to = "correlation")

cor_data

# Create the heatmap
ggplot(cor_data, aes(x = var1, y = var2, fill = correlation)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", midpoint = 0, limit = c(-1, 1)) +
  labs(
    title = "Correlation Heatmap of Numeric Variables",
    x = "",
    y = ""
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 8)
  )
```
